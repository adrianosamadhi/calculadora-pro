<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Precifica√ß√£o Pro - Adriano Santos</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' };
    </script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { margin: 0; font-family: ui-sans-serif, system-ui, sans-serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #6b7280; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #374151; }
        
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
          animation: fadeIn 0.4s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-950 transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ==========================================
        // üõë COLOQUE SUAS CHAVES DO SUPABASE AQUI üõë
        // ==========================================
        const supabaseUrl = 'https://pttckajgbilxtlvhrdsm.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0dGNrYWpnYmlseHRsdmhyZHNtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMzkyMDYsImV4cCI6MjA4NzcxNTIwNn0.8buGbTrL0_nsFW9B0JPf_PyFeYbvAbe2UjMISpdQ6Os';
        
        // Inicializa a conex√£o com o seu Banco de Dados
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // --- DADOS DAS TABELAS (Tabelas do ML) ---
        const mlRates = {
          "At√© 0,3 kg": [5.65, 6.35, 7.75, 12.35, 13.35, 15.45, 16.45, 20.95],
          "De 0,3 a 0,5 kg": [5.95, 6.75, 7.95, 13.25, 15.45, 17.65, 18.85, 23.55],
          "De 0,5 a 1 kg": [6.05, 6.75, 7.95, 14.15, 19.85, 18.45, 19.85, 22.65],
          "De 1 a 1,5 kg": [6.15, 6.85, 8.15, 14.45, 18.45, 19.45, 21.15, 24.65],
          "De 1,5 a 2 kg": [6.35, 6.75, 8.15, 15.75, 19.33, 21.05, 22.65, 25.55],
          "De 2 a 3 kg": [6.35, 7.95, 9.95, 14.85, 21.05, 22.65, 25.65, 26.25],
          "De 3 a 4 kg": [6.35, 8.15, 9.95, 15.85, 28.65, 27.75, 27.75, 33.55],
          "De 4 a 5 kg": [6.95, 8.25, 10.15, 25.55, 28.65, 28.65, 30.75, 40.05],
          "De 5 a 7 kg": [6.65, 8.95, 10.33, 27.65, 31.45, 33.65, 37.65, 43.25],
          "De 6 a 7 kg": [6.75, 9.35, 11.35, 31.55, 38.65, 36.05, 32.65, 50.65],
          "De 7 a 8 kg": [6.75, 9.25, 11.33, 28.95, 54.35, 55.05, 42.65, 54.35],
          "De 9 a 11 kg": [7.23, 9.15, 11.33, 42.15, 54.65, 59.35, 59.45, 69.65],
          "De 13 a 15 kg": [7.25, 10.15, 11.33, 52.45, 59.95, 67.45, 67.45, 75.95]
        };

        const mlPriceTiers = [18.99, 38.99, 78.99, 98.99, 119.99, 149.99, 199.99, Infinity];
        const mlTierNames = [
          "At√© R$ 18,99", "R$ 19 a R$ 38,99", "R$ 39 a R$ 78,99", "R$ 79 a R$ 98,99", 
          "R$ 100 a R$ 119,99", "R$ 120 a R$ 149,99", "R$ 150 a R$ 199,99", "Acima de R$ 200"
        ];

        const formatCurrency = (value) => {
          if (!value) return "0,00";
          const numericValue = value.replace(/\D/g, "");
          const floatValue = (Number(numericValue) / 100).toFixed(2);
          return floatValue.replace(".", ",").replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        };

        const parseCurrency = (val) => Number(val.replace(/\./g, '').replace(',', '.')) || 0;
        const parsePercent = (val) => Number(val.replace(',', '.')) || 0;

        function App() {
          const [isLoggedIn, setIsLoggedIn] = useState(false);
          const [email, setEmail] = useState('');
          const [password, setPassword] = useState('');
          const [authError, setAuthError] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const [isCheckingSession, setIsCheckingSession] = useState(true);

          const [isDarkMode, setIsDarkMode] = useState(true);
          const [platform, setPlatform] = useState('ML');
          const [custoProduto, setCustoProduto] = useState('');
          const [embalagem, setEmbalagem] = useState('');
          const [imposto, setImposto] = useState('');
          const [lucroDesejado, setLucroDesejado] = useState('20');
          const [taxaMarketplace, setTaxaMarketplace] = useState('14');
          const [pesoProduto, setPesoProduto] = useState('De 1 a 1,5 kg');
          const [resultado, setResultado] = useState(null);
          const [erro, setErro] = useState(null);

          useEffect(() => {
              if (isDarkMode) {
                  document.documentElement.classList.add('dark');
              } else {
                  document.documentElement.classList.remove('dark');
              }
          }, [isDarkMode]);

          useEffect(() => {
            supabase.auth.getSession().then(({ data: { session } }) => {
              setIsLoggedIn(!!session);
              setIsCheckingSession(false);
            });

            const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
              setIsLoggedIn(!!session);
            });

            return () => subscription.unsubscribe();
          }, []);

          const handleLogin = async (e) => {
            e.preventDefault();
            setIsLoading(true);
            setAuthError('');
            
            const { data, error } = await supabase.auth.signInWithPassword({
              email: email,
              password: password,
            });

            if (error) {
              setAuthError('E-mail ou senha incorretos. Acesso negado.');
            } else {
              setIsLoggedIn(true);
              setAuthError('');
            }
            setIsLoading(false);
          };

          const handleLogout = async () => {
            await supabase.auth.signOut();
            setIsLoggedIn(false);
            setResultado(null);
            setEmail('');
            setPassword('');
          };

          const handleCurrencyChange = (setter) => (e) => setter(formatCurrency(e.target.value));
          const handlePercentChange = (setter) => (e) => setter(e.target.value.replace(/[^0-9,]/g, ''));

          const calcular = () => {
            setErro(null);
            setResultado(null);

            const custo = parseCurrency(custoProduto);
            const emb = parseCurrency(embalagem);
            const impostoPct = parsePercent(imposto) / 100;
            const lucroPct = parsePercent(lucroDesejado) / 100;
            const taxaMLPct = parsePercent(taxaMarketplace) / 100;

            const basePct = platform === 'ML' ? (impostoPct + lucroPct + taxaMLPct) : (impostoPct + lucroPct + 0.20); 
            if (basePct >= 1) {
              setErro("A soma das porcentagens (Imposto + Lucro + Comiss√£o) √© maior ou igual a 100%. Imposs√≠vel calcular.");
              return;
            }

            if (custo === 0) {
              setErro("Por favor, insira o Custo do Produto.");
              return;
            }

            let melhorPreco = null;
            let detalhesCalculo = null;

            for (let p = custo + emb; p <= 15000; p += 0.01) {
              let comissaoVenda = 0;
              let custoFixoFrete = 0;
              let comissaoPctReal = 0;

              if (platform === 'SHOPEE') {
                if (p <= 79.99) { comissaoPctReal = 0.20; custoFixoFrete = 4; } 
                else if (p <= 99.99) { comissaoPctReal = 0.14; custoFixoFrete = 16; } 
                else if (p <= 199.99) { comissaoPctReal = 0.14; custoFixoFrete = 20; } 
                else { comissaoPctReal = 0.14; custoFixoFrete = 26; }
                comissaoVenda = p * comissaoPctReal;
              } 
              else if (platform === 'ML') {
                comissaoPctReal = taxaMLPct;
                comissaoVenda = p * comissaoPctReal;
                let tierIdx = mlPriceTiers.findIndex(t => p <= t);
                if (tierIdx === -1) tierIdx = mlPriceTiers.length - 1;
                custoFixoFrete = mlRates[pesoProduto][tierIdx];
              }

              const valorImposto = p * impostoPct;
              const custosTotais = custo + emb + custoFixoFrete + comissaoVenda + valorImposto;
              const lucroAtual = p - custosTotais;
              const lucroAtualPct = lucroAtual / p;

              if (lucroAtualPct >= lucroPct) {
                melhorPreco = p;
                let nomeFaixa = "";
                if (platform === 'ML') {
                    let tierIdx = mlPriceTiers.findIndex(t => p <= t);
                    if (tierIdx === -1) tierIdx = mlPriceTiers.length - 1;
                    nomeFaixa = mlTierNames[tierIdx];
                }

                detalhesCalculo = {
                  custoBase: custo + emb,
                  freteTaxa: custoFixoFrete,
                  comissaoVenda,
                  valorImposto,
                  lucroLiq: lucroAtual,
                  lucroLiqPct: lucroAtualPct * 100,
                  margemUsada: comissaoPctReal * 100,
                  faixaAplicada: nomeFaixa
                };
                break;
              }
            }

            if (melhorPreco) {
              setResultado({ precoSugerido: melhorPreco, ...detalhesCalculo });
            } else {
              setErro("N√£o foi poss√≠vel encontrar um pre√ßo vi√°vel. Verifique as taxas.");
            }
          };

          useEffect(() => {
            setResultado(null);
            setErro(null);
          }, [platform, custoProduto, embalagem, imposto, lucroDesejado, taxaMarketplace, pesoProduto]);

          const theme = {
            label: `text-sm font-bold uppercase tracking-wide ${isDarkMode ? 'text-slate-400' : 'text-slate-600'}`,
            icon: isDarkMode ? "text-slate-500" : "text-slate-400",
            input: `w-full py-3 border rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all font-semibold text-lg ${isDarkMode ? 'bg-slate-950 border-slate-700 text-white placeholder-slate-600' : 'bg-slate-50 border-slate-200 text-slate-800 placeholder-slate-400'}`,
            lucroLabel: "text-sm font-bold uppercase tracking-wide text-orange-500",
            lucroInput: `w-full pl-4 pr-11 py-3 border rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all font-bold text-lg ${isDarkMode ? 'bg-orange-500/10 border-orange-500/30 text-orange-400 placeholder-orange-700/50' : 'bg-orange-50 border-orange-200 text-orange-700 placeholder-orange-300'}`,
            error: `mt-6 p-4 rounded-xl flex items-center gap-3 font-medium border ${isDarkMode ? 'bg-red-500/10 border-red-500/20 text-red-400' : 'bg-red-50 border-red-200 text-red-600'}`,
            resultCard: `rounded-2xl p-6 md:p-8 text-white shadow-inner relative overflow-hidden border ${isDarkMode ? 'bg-slate-950 border-slate-800' : 'bg-gradient-to-br from-slate-800 to-slate-900 border-slate-700'}`,
            resultItemBorder: isDarkMode ? 'border-slate-800' : 'border-slate-700',
            composicaoBg: `mt-6 p-5 rounded-xl border ${isDarkMode ? 'bg-slate-900 border-slate-800' : 'bg-slate-800/50 border-slate-700'}`,
          };

          if (isCheckingSession) {
            return (
              <div className="min-h-screen bg-slate-950 flex flex-col items-center justify-center">
                 <div className="w-10 h-10 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
                 <p className="mt-4 text-slate-400">Verificando seguran√ßa...</p>
              </div>
            );
          }

          if (!isLoggedIn) {
            return (
              <div className="min-h-screen bg-slate-950 flex flex-col items-center justify-center p-4 font-sans relative overflow-hidden">
                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-orange-500/20 blur-[100px] rounded-full pointer-events-none"></div>
                
                <div className="w-full max-w-md bg-slate-900 border border-slate-800 rounded-3xl p-8 md:p-10 shadow-2xl relative z-10 animate-fade-in">
                  <div className="text-center mb-8">
                    <div className="w-16 h-16 bg-gradient-to-br from-orange-500 to-rose-500 rounded-2xl mx-auto flex items-center justify-center mb-6 shadow-lg shadow-orange-500/30">
                      <i className="ph-fill ph-lock-key text-white text-3xl"></i>
                    </div>
                    <h1 className="text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-rose-400 mb-2">
                      Acesso Exclusivo
                    </h1>
                    <p className="text-slate-400 text-sm">Fa√ßa login para usar a Calculadora de Precifica√ß√£o Pro.</p>
                  </div>

                  <form onSubmit={handleLogin} className="space-y-5">
                    <div className="space-y-2">
                      <label className="text-xs font-bold uppercase tracking-wider text-slate-400">E-mail</label>
                      <div className="relative">
                        <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                          <i className="ph ph-envelope-simple text-slate-500 text-lg"></i>
                        </div>
                        <input 
                          type="email" 
                          required
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                          placeholder="seu@email.com"
                          className="w-full bg-slate-950 border border-slate-800 text-white rounded-xl py-3 pl-11 pr-4 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all"
                        />
                      </div>
                    </div>

                    <div className="space-y-2">
                      <label className="text-xs font-bold uppercase tracking-wider text-slate-400">Senha</label>
                      <div className="relative">
                        <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                          <i className="ph ph-key text-slate-500 text-lg"></i>
                        </div>
                        <input 
                          type="password" 
                          required
                          value={password}
                          onChange={(e) => setPassword(e.target.value)}
                          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                          className="w-full bg-slate-950 border border-slate-800 text-white rounded-xl py-3 pl-11 pr-4 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition-all"
                        />
                      </div>
                    </div>

                    {authError && (
                      <div className="p-3 bg-red-500/10 border border-red-500/20 rounded-lg flex items-center gap-2 text-red-400 text-sm">
                        <i className="ph-fill ph-warning-circle text-lg shrink-0"></i> 
                        <span>{authError}</span>
                      </div>
                    )}

                    <button 
                      type="submit" 
                      disabled={isLoading}
                      className="w-full py-3.5 mt-4 bg-gradient-to-r from-orange-500 to-rose-500 hover:from-orange-600 hover:to-rose-600 text-white rounded-xl font-bold flex justify-center items-center gap-2 transition-all active:scale-95 disabled:opacity-70"
                    >
                      {isLoading ? <span className="animate-pulse">Autenticando no Servidor...</span> : <><i className="ph ph-sign-in text-xl"></i> Entrar no Sistema</>}
                    </button>
                  </form>
                    <p className="text-center mt-4 text-sm text-slate-400">
  Primeiro acesso? Use a senha padr√£o: <strong className="text-white">Calculadora@123</strong>
</p>

                  <p className="text-center mt-6 text-xs text-slate-500">
                    Ainda n√£o tem acesso? <a href="#" className="text-orange-400 hover:text-orange-300 font-bold underline">Adquira sua licen√ßa aqui</a>.
                  </p>
                </div>
              </div>
            );
          }

          return (
            <div className={`min-h-screen py-10 px-4 font-sans transition-colors duration-300 animate-fade-in ${isDarkMode ? 'bg-slate-950 text-slate-200' : 'bg-gradient-to-br from-slate-100 to-slate-200 text-slate-800'}`}>
              <div className="max-w-4xl mx-auto relative">
                
                <div className="absolute top-0 right-0 md:-mt-4 flex gap-3">
                  <button
                    onClick={() => setIsDarkMode(!isDarkMode)}
                    className={`p-3 rounded-full transition-all duration-300 shadow-lg flex items-center justify-center ${
                      isDarkMode ? 'bg-slate-800 text-yellow-400 hover:bg-slate-700' : 'bg-white text-slate-500 hover:bg-slate-50'
                    }`}
                    title="Mudar Tema"
                  >
                    {isDarkMode ? <i className="ph-fill ph-sun text-xl"></i> : <i className="ph-fill ph-moon text-xl"></i>}
                  </button>
                  <button
                    onClick={handleLogout}
                    className={`p-3 rounded-full transition-all duration-300 shadow-lg flex items-center justify-center ${
                      isDarkMode ? 'bg-red-500/10 text-red-400 hover:bg-red-500/20' : 'bg-white text-red-500 hover:bg-red-50'
                    }`}
                    title="Sair do Sistema"
                  >
                    <i className="ph-fill ph-lock-key text-xl"></i>
                  </button>
                </div>

                <div className="text-center mb-10 pt-16 md:pt-0">
                  <h1 className="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-orange-500 to-rose-400 mb-2">
                    Calculadora de Precifica√ß√£o
                  </h1>
                  <p className={`text-lg font-medium ${isDarkMode ? 'text-slate-400' : 'text-slate-500'}`}>Acesso Autorizado ‚Ä¢ Bem-vindo</p>
                </div>

                <div className={`rounded-3xl shadow-2xl overflow-hidden border transition-colors duration-300 ${isDarkMode ? 'bg-slate-900 border-slate-800' : 'bg-white border-slate-100'}`}>
                  
                  <div className="flex w-full">
                    <button
                      onClick={() => setPlatform('ML')}
                      className={`flex-1 py-5 text-lg font-bold transition-all duration-300 flex justify-center items-center gap-2 ${
                        platform === 'ML' 
                        ? 'bg-yellow-400 text-yellow-950 border-b-4 border-yellow-600' 
                        : isDarkMode 
                          ? 'bg-slate-950 text-slate-500 hover:bg-slate-800 hover:text-slate-300'
                          : 'bg-slate-50 text-slate-400 hover:bg-slate-100 hover:text-slate-600'
                      }`}
                    >
                      <i className="ph ph-tote text-2xl"></i> Mercado Livre
                    </button>
                    <button
                      onClick={() => setPlatform('SHOPEE')}
                      className={`flex-1 py-5 text-lg font-bold transition-all duration-300 flex justify-center items-center gap-2 ${
                        platform === 'SHOPEE' 
                        ? 'bg-orange-500 text-white border-b-4 border-orange-700' 
                        : isDarkMode 
                          ? 'bg-slate-950 text-slate-500 hover:bg-slate-800 hover:text-slate-300'
                          : 'bg-slate-50 text-slate-400 hover:bg-slate-100 hover:text-slate-600'
                      }`}
                    >
                      <i className="ph ph-tote text-2xl"></i> Shopee
                    </button>
                  </div>

                  <div className="p-6 md:p-10">
                    
                    <div className={`mb-8 p-4 rounded-xl flex items-start gap-3 border transition-colors ${
                      platform === 'ML' 
                        ? isDarkMode ? 'bg-yellow-500/10 border-yellow-500/20 text-yellow-200' : 'bg-yellow-50 border-yellow-200 text-yellow-800'
                        : isDarkMode ? 'bg-orange-500/10 border-orange-500/20 text-orange-200' : 'bg-orange-50 border-orange-200 text-orange-800'
                    }`}>
                      <i className="ph-fill ph-info shrink-0 mt-0.5 text-xl"></i>
                      <p className="text-sm md:text-base leading-relaxed">
                        <strong>Automa√ß√£o Ativa:</strong> A tabela oficial do {platform === 'ML' ? 'Mercado Livre' : 'Shopee'} j√° est√° embutida. Preencha os custos e n√≥s encontraremos exatamente o valor final para voc√™ ter o lucro desejado, sem precisar adivinhar!
                      </p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                      
                      <div className="space-y-2">
                        <label className={theme.label}>Custo do Produto (R$)</label>
                        <div className="relative">
                          <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i className={`ph ph-currency-dollar text-lg ${theme.icon}`}></i>
                          </div>
                          <input 
                            type="text" 
                            value={custoProduto}
                            onChange={handleCurrencyChange(setCustoProduto)}
                            placeholder="0,00"
                            className={`${theme.input} pl-11 pr-4`}
                          />
                        </div>
                      </div>

                      <div className="space-y-2">
                        <label className={theme.label}>Embalagem/Outros (R$)</label>
                        <div className="relative">
                          <div className="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i className={`ph ph-package text-lg ${theme.icon}`}></i>
                          </div>
                          <input 
                            type="text" 
                            value={embalagem}
                            onChange={handleCurrencyChange(setEmbalagem)}
                            placeholder="0,00"
                            className={`${theme.input} pl-11 pr-4`}
                          />
                        </div>
                      </div>

                      <div className="space-y-2">
                        <label className={`${theme.label} flex justify-between`}>
                          <span>Imposto sobre a Venda</span>
                          <span className={`text-xs font-normal mt-0.5 ${isDarkMode ? 'text-slate-500' : 'text-slate-400'}`}>(MEI = 0)</span>
                        </label>
                        <div className="relative">
                          <input 
                            type="text" 
                            value={imposto}
                            onChange={handlePercentChange(setImposto)}
                            placeholder="0"
                            className={`${theme.input} pl-4 pr-11`}
                          />
                          <div className="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                            <i className={`ph ph-percent text-lg ${theme.icon}`}></i>
                          </div>
                        </div>
                      </div>

                      <div className="space-y-2">
                        <label className={theme.lucroLabel}>Lucro L√≠quido Desejado</label>
                        <div className="relative">
                          <input 
                            type="text" 
                            value={lucroDesejado}
                            onChange={handlePercentChange(setLucroDesejado)}
                            placeholder="20"
                            className={theme.lucroInput}
                          />
                          <div className="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                            <i className="ph ph-percent text-lg text-orange-500"></i>
                          </div>
                        </div>
                      </div>

                      {platform === 'ML' && (
                        <>
                          <div className="space-y-2">
                            <label className={theme.label}>Taxa da Categoria</label>
                            <div className="relative">
                              <input 
                                type="text" 
                                value={taxaMarketplace}
                                onChange={handlePercentChange(setTaxaMarketplace)}
                                placeholder="14"
                                className={`${theme.input} pl-4 pr-11`}
                              />
                              <div className="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                                <i className={`ph ph-percent text-lg ${theme.icon}`}></i>
                              </div>
                            </div>
                          </div>

                          <div className="space-y-2">
                            <label className={theme.label}>Peso do Produto</label>
                            <select 
                              value={pesoProduto}
                              onChange={(e) => setPesoProduto(e.target.value)}
                              className={`${theme.input} px-4 appearance-none`}
                            >
                              {Object.keys(mlRates).map(peso => (
                                <option key={peso} value={peso} className={isDarkMode ? "bg-slate-900" : "bg-white"}>{peso}</option>
                              ))}
                            </select>
                          </div>
                        </>
                      )}

                    </div>

                    {erro && (
                      <div className={theme.error}>
                        <i className="ph-fill ph-warning-circle text-xl"></i>
                        {erro}
                      </div>
                    )}

                    <button 
                      onClick={calcular}
                      className="mt-8 w-full py-4 bg-gradient-to-r from-orange-500 to-rose-500 hover:from-orange-600 hover:to-rose-600 text-white rounded-xl font-bold text-xl shadow-lg shadow-orange-500/20 transform transition-all active:scale-95 flex justify-center items-center gap-2"
                    >
                      <i className="ph ph-calculator text-2xl"></i>
                      CALCULAR PRE√áO IDEAL
                    </button>

                    {resultado && (
                      <div className="mt-10 animate-fade-in">
                        <div className={theme.resultCard}>
                          
                          <div className="absolute top-0 right-0 bg-green-500 text-white px-4 py-1 rounded-bl-xl font-bold text-sm flex items-center gap-1">
                            <i className="ph-fill ph-check-circle text-lg"></i> Precifica√ß√£o Segura
                          </div>

                          <p className="text-slate-400 font-medium mb-1 uppercase tracking-wider text-sm">Sua Sugest√£o de</p>
                          <h2 className="text-3xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-300 mb-8">
                            R$ {resultado.precoSugerido.toFixed(2).replace('.', ',')}
                          </h2>

                          <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 text-sm md:text-base">
                            
                            <div className={`flex justify-between items-center border-b pb-2 ${theme.resultItemBorder}`}>
                              <span className="text-slate-400">Custo + Embalagem:</span>
                              <span className="font-semibold text-slate-200">R$ {resultado.custoBase.toFixed(2).replace('.', ',')}</span>
                            </div>
                            
                            <div className={`flex justify-between items-center border-b pb-2 ${theme.resultItemBorder}`}>
                              <span className="text-slate-400">
                                {platform === 'ML' ? (
                                  <>Frete Fixo <span className="text-xs text-slate-500">({resultado.faixaAplicada})</span>:</>
                                ) : 'Taxa Fixa (Shopee):'}
                              </span>
                              <span className="font-semibold text-red-400">- R$ {resultado.freteTaxa.toFixed(2).replace('.', ',')}</span>
                            </div>

                            <div className={`flex justify-between items-center border-b pb-2 ${theme.resultItemBorder}`}>
                              <span className="text-slate-400">Comiss√£o ({resultado.margemUsada.toFixed(0)}%):</span>
                              <span className="font-semibold text-red-400">- R$ {resultado.comissaoVenda.toFixed(2).replace('.', ',')}</span>
                            </div>

                            <div className={`flex justify-between items-center border-b pb-2 ${theme.resultItemBorder}`}>
                              <span className="text-slate-400">Impostos:</span>
                              <span className="font-semibold text-red-400">- R$ {resultado.valorImposto.toFixed(2).replace('.', ',')}</span>
                            </div>

                          </div>

                          <div className={theme.composicaoBg}>
                            <h3 className="text-slate-300 font-bold uppercase tracking-wide text-xs mb-4">Composi√ß√£o do Pre√ßo</h3>
                            <div className="space-y-3 text-sm">
                              <div className="flex justify-between">
                                <span className="text-slate-400">Custos Fixos (Produto + Emb + Frete)</span>
                                <span className="font-semibold text-slate-200">R$ {(resultado.custoBase + resultado.freteTaxa).toFixed(2).replace('.', ',')}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-400">Taxa do Marketplace</span>
                                <span className="font-semibold text-slate-200">R$ {resultado.comissaoVenda.toFixed(2).replace('.', ',')}</span>
                              </div>
                              <div className="flex justify-between">
                                <span className="text-slate-400">Imposto</span>
                                <span className="font-semibold text-slate-200">R$ {resultado.valorImposto.toFixed(2).replace('.', ',')}</span>
                              </div>
                              <div className={`flex justify-between pt-2 border-t ${theme.resultItemBorder}`}>
                                <span className="text-slate-300 font-bold">Total de Dedu√ß√µes (%)</span>
                                <span className="font-bold text-orange-400">
                                  {(resultado.margemUsada + (parsePercent(imposto) || 0) + (parsePercent(lucroDesejado) || 0)).toFixed(2).replace('.', ',')}%
                                </span>
                              </div>
                            </div>
                          </div>

                          <div className="mt-8 bg-emerald-500/10 p-5 rounded-xl border border-emerald-500/20 flex items-center justify-between">
                            <div>
                              <p className="text-emerald-400 font-bold uppercase tracking-wider text-sm mb-1">Seu Lucro L√≠quido</p>
                              <p className="text-2xl md:text-3xl font-extrabold text-emerald-300">R$ {resultado.lucroLiq.toFixed(2).replace('.', ',')}</p>
                            </div>
                            <div className="text-right">
                              <p className="text-slate-400 font-medium mb-1">Margem</p>
                              <div className="bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded-lg font-bold text-xl">
                                {resultado.lucroLiqPct.toFixed(1).replace('.', ',')}%
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>
                    )}

                  </div>
                </div>

                <p className={`text-center text-sm mt-8 pb-10 ${isDarkMode ? 'text-slate-600' : 'text-slate-500'}`}>
                  Esta ferramenta calcula os custos dinamicamente utilizando as regras oficiais vigentes (Mercado Livre e Shopee).
                </p>

              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
